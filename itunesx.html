<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>iTunes-X RIDHO</title>
    <link
      rel="stylesheet"
      href="./assets/plugins/bootstrap/css/bootstrap.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css"
    />
    <link rel="stylesheet" href="./assets/css/itunesx.css" />
  </head>
  <body>
    <section id="iTunes">
      <div class="container-fluid">
        <div class="row box-content search-box">
          <div class="search-bar">
            <input
              type="text"
              class="form-control input-search"
              placeholder="search your music here..."
            />
          </div>
        </div>

        <div class="row box-content list-music">
          <div class="title-box">
            <h4>List Of Music</h4>
          </div>
          <div class="wrapper-list"></div>
        </div>

        <div class="row box-content music-player">
          <div class="wrapper-music-player hide">
            <div class="wrapper-box">
              <div class="image-music">
                <div class="image" style="background-image: url()"></div>
              </div>
              <div class="box-player">
                <div class="description-music">
                  <h4 class="title-player"></h4>
                  <span class="artist-name">
                    <p>Artist :</p>
                  </span>
                </div>
              </div>
            </div>
            <div class="player-music">
              <div class="range-box">
                <input type="range" id="music-duration" min="0" value="0" />
              </div>
              <div class="button-box">
                <button id="prev" class="prev">Prev</button>
                <button id="pause" class="pause">Pause</button>
                <button id="play" class="play">Play</button>
                <button id="next" class="next">Next</button>
              </div>
            </div>
            <div class="close-button">X</div>
          </div>
        </div>
      </div>
    </section>

    <script type="text/javascript">
      let textSearch = document.querySelector('.input-search')

      let wrapperList = document.querySelector('.list-music .wrapper-list')

      textSearch.addEventListener('keyup', function (event) {
        if (event.keyCode === 13) {
          wrapperList.innerHTML = ''
          searchList(textSearch.value)
        }
      })

      searchList()

      function searchList(params = 'Indonesia') {
        fetch(
          'https://itunes.apple.com/search?term=' +
            params +
            '&country=ID&media=music&limit=20'
        )
          .then(function (response) {
            // console.log(response)

            if (response.status !== 200) {
              alert('Fetch data Error!')
              searchList()
            } else {
              return response.json()
            }
          })
          .then(function (data) {
            console.log(data)
            buildList(data.results)
          })
      }

      function buildList(arrayList) {
        for (let i = 0; i < arrayList.length; i++) {
          wrapperList.insertAdjacentHTML(
            'beforeend',
            `
          <div
            class="box-music-list list-number-${i}"
            indexdata=${i}
            iddata="${arrayList[i].collectionId}
            id="list-${i}"
          >
            <div class="images-box">
              <div
                class="images"
                style="
                  background-image: url(${arrayList[i].artworkUrl100});
                "
              ></div>
            </div>
            <div class="desc-box">
              <h4 class="title">
                ${arrayList[i].trackName}
              </h4>
              <span class="artist">
                ${arrayList[i].artistName}
              </span>
              <span class="album">
                ${arrayList[i].collectionName}
              </span>
            </div>
            <div class="button-play">
              <button type="button" value="${i}" class="button-playing btn-play-${i} btn btn-outline-light">
                <i class="bi-play-circle"></i>
                PLAY
              </button>
            </div>
            <div class="button-stop hide">
              <button type="button" value="${i}" class="button-stopping btn-stop-${i} btn btn-outline-danger">
                <i class="bi-stop-circle-fill"></i>
                STOP
              </button>
            </div>
          `
          )
        }

        let playing = document.querySelectorAll(
          '.wrapper-list .box-music-list .button-play .button-playing'
        )

        let divPlay = document.querySelectorAll(
          '.wrapper-list .box-music-list .button-play'
        )

        let divStop = document.querySelectorAll(
          '.wrapper-list .box-music-list .button-stop'
        )

        let stopping = document.querySelectorAll(
          '.wrapper-list .box-music-list .button-stop .button-stopping'
        )

        let divBoxPlayer = document.querySelector(
          '.box-content.music-player .wrapper-music-player'
        )

        let minPoster = document.querySelector('.wrapper-box .image-music')

        let title_player = document.querySelector(
          '.box-player .description-music .title-player'
        )

        let artist_name = document.querySelector(
          '.box-player .description-music .artist-name'
        )

        let button_prev = document.querySelector(
          '.wrapper-music-player .player-music .button-box .prev'
        )

        let button_next = document.querySelector(
          '.wrapper-music-player .player-music .button-box .next'
        )

        $('.button-playing').click(function () {
          var i = $(this).val()

          /* button */
          divPlay[i].classList.add('hide')
          divStop[i].classList.remove('hide')
          let selector = document.getElementsByClassName('button-play')
          console.log(selector)

          /* music player */
          divBoxPlayer.classList.add('active')
          divBoxPlayer.classList.remove('hide')

          /* playing */
          let playlist = document.querySelector('.player-music .range-box')
          playlist.innerHTML = `
            <audio controls class="audio-${i} w-50 mx-auto col-12" style="display: none;">
              <source class="trackPreview-${i}" src="${arrayList[i].previewUrl}"> type="audio/mpeg"><</source>
            </audio>
          `
          document.querySelector('.audio-' + i).play()

          /* detail description di music player */
          minPoster.innerHTML = `
            <div class="image-music">
              <div class="image" style="background-image: url(${arrayList[i].artworkUrl60})"></div>
            </div>
          `
          title_player.innerHTML = `
            <h4 class="title-player">
              ${arrayList[i].trackName}
            </h4>
          `
          artist_name.innerHTML = `
            <span class="artist-name">
              <p>Artist :</p>
              ${arrayList[i].artistName}
            </span>
          `

          /* detail button di music player */
          $('.prev').click(function () {
            let currentIndex = i

            /* stop playing */
            document.querySelector('.audio-' + currentIndex).pause()
            document.querySelector('.audio-' + currentIndex).currentTime = 0

            console.log('indeks saat ini: ' + currentIndex)

            divPlay[currentIndex].classList.remove('hide')
            divStop[currentIndex].classList.add('hide')

            currentIndex = currentIndex - 1

            if (currentIndex < 0) {
              currentIndex = 0
              alert('Playlist Pertama')
            }

            console.log('indeks after: ' + currentIndex)
            divPlay[currentIndex].classList.add('hide')
            divStop[currentIndex].classList.remove('hide')

            /* start new playing */
            let playlist = document.querySelector('.player-music .range-box')
            playlist.innerHTML = `
              <audio controls class="audio-${currentIndex} w-50 mx-auto col-12" style="display: none;">
                <source class="trackPreview-${currentIndex}" src="${arrayList[currentIndex].previewUrl}"> type="audio/mpeg"><</source>
              </audio>
            `
            document.querySelector('.audio-' + currentIndex).play()
            /* detail description di music player */
            minPoster.innerHTML = `
              <div class="image-music">
                <div class="image" style="background-image: url(${arrayList[currentIndex].artworkUrl60})"></div>
              </div>
            `
            title_player.innerHTML = `
              <h4 class="title-player">
                ${arrayList[currentIndex].trackName}
              </h4>
            `
            artist_name.innerHTML = `
              <span class="artist-name">
                <p>Artist :</p>
                ${arrayList[currentIndex].artistName}
              </span>
            `
          })
          /* next */
          $('.next').click(function () {
            let currentIndex = i

            /* stop playing */
            document.querySelector('.audio-' + currentIndex).pause()
            document.querySelector('.audio-' + currentIndex).currentTime = 0
            console.log('indeks pertama: ' + currentIndex)

            divPlay[currentIndex].classList.remove('hide')
            divStop[currentIndex].classList.add('hide')

            currentIndex = parseInt(currentIndex) + 1

            if (currentIndex >= arrayList.length) {
              currentIndex = arrayList.length - 1
              alert('Playlist Terakhir')
            }

            // alert('indeks after: ' + currentIndex)
            divPlay[currentIndex].classList.add('hide')
            divStop[currentIndex].classList.remove('hide')
            console.log('indeks setelahnya: ' + currentIndex)

            /* start new playing */
            let playlist = document.querySelector('.player-music .range-box')
            playlist.innerHTML = `
              <audio controls class="audio-${currentIndex} w-50 mx-auto col-12" style="display: none;">
                <source class="trackPreview-${currentIndex}" src="${arrayList[currentIndex].previewUrl}"> type="audio/mpeg"><</source>
              </audio>
            `
            document.querySelector('.audio-' + currentIndex).play()
            /* detail description di music player */
            minPoster.innerHTML = `
              <div class="image-music">
                <div class="image" style="background-image: url(${arrayList[currentIndex].artworkUrl60})"></div>
              </div>
            `
            title_player.innerHTML = `
              <h4 class="title-player">
                ${arrayList[currentIndex].trackName}
              </h4>
            `
            artist_name.innerHTML = `
              <span class="artist-name">
                <p>Artist :</p>
                ${arrayList[currentIndex].artistName}
              </span>
            `
          })
          /* pause */
          $('.pause').click(function () {
            let currentIndex = i
            /* stop playing */
            document.querySelector('.audio-' + currentIndex).pause()
            document.querySelector('.audio-' + currentIndex).currentTime = 0
          })
          /* play */
          $('.play').click(function () {
            /* start new playing */
            let currentIndex = i
            let playlist = document.querySelector('.player-music .range-box')
            playlist.innerHTML = `
              <audio controls class="audio-${currentIndex} w-50 mx-auto col-12" style="display: none;">
                <source class="trackPreview-${currentIndex}" src="${arrayList[currentIndex].previewUrl}"> type="audio/mpeg"><</source>
              </audio>
            `
            document.querySelector('.audio-' + currentIndex).play()
          })

          /* tombol X di music player */
          $('.close-button').click(function () {
            let index = i
            /* music player */
            divBoxPlayer.classList.remove('active')
            divBoxPlayer.classList.add('hide')

            /* button play+stop all */
            divPlay[index].classList.remove('hide')
            divStop[index].classList.add('hide')

            /* stop playing */
            document.querySelector('.audio-' + index).pause()
            document.querySelector('.audio-' + index).currentTime = 0
          })
        })

        $('.button-stopping').click(function () {
          let i = $(this).val()
          divPlay[i].classList.remove('hide')
          divStop[i].classList.add('hide')
          /* music player */
          divBoxPlayer.classList.remove('active')
          divBoxPlayer.classList.add('hide')
          /* stop playing */
          document.querySelector('.audio-' + i).pause()
          document.querySelector('.audio-' + i).currentTime = 0
          /* detail description di music player */
          minPoster.innerHTML = ''
          title_player.innerHTML = ''
          artist_name.innerHTML = ''
        })
      }
    </script>
    <script
      src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
      integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
      integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
